<!-- <p>spa-lecturer works!</p> -->


<!-- <p>visualiser works!</p> -->
<div class="container mt-4">
	<h3 class="text-primary text-center mb-4">SPA Student-Proposing Visualizer</h3>
  
	<div class="text-center mb-4">
		<button class="btn btn-outline-info" (click)="descshow()">More about the algorithm</button>
	  </div>
	
	  <div *ngIf="showdesc" class="alert alert-secondary">
		<strong>Initialization:</strong><br>
		&rarr; All students start free and unassigned.<br>
		&rarr; Every project and lecturer is unsubscribed (no provisional assignments).<br><br>
	
		Initially all students are free, and all projects and lecturers are totally unsubscribed.
		 As long as there is some student 𝑠𝑖 who is free and who has a non-empty preference list,
		  𝑠𝑖 applies to the first project 𝑝𝑗 on his/her list. We let 𝑙𝑘 be the lecturer who offers 𝑝𝑗. 
		  Immediately, 𝑠𝑖 becomes provisionally assigned to 𝑝𝑗 (and to 𝑙𝑘). <br> <br>

		  If 𝑝𝑗 is over-subscribed, then the worst student 𝑠𝑟 assigned to 𝑝𝑗 is rejected. The pair 
		  (𝑠𝑟,𝑝𝑗) will be deleted by the subsequent conditional that tests for 𝑝𝑗 being full. The pair (𝑠𝑟,𝑝𝑡) 
		  will be deleted by either of the two subsequent conditionals, where 𝑝𝑡 was the project most recently assigned 𝑠𝑟.
		  <br> <br>

		  If the project is full (i.e., at capacity), the lecturer removes from the project's preference <br>
		   list all students less preferred than the worst currently assigned student.

		   <br> <br>
		   The algorithm ends when every free student has an empty preference list (i.e. cannot propose any further)
		    or all students have been provisionally assigned. The final matching is then the set of provisional assignments.
			<br>
			<br>

			<strong>Outcome : Student optimal </strong>  allocations (i.e., it prioritises the student preferences over faculty)


	  </div>

	  <div *ngIf="isLoading" class="text-center mt-5">
		<div class="spinner-border text-primary" role="status">
		<span class="visually-hidden">Loading Algorithm Data...</span>
		</div>
		<p>Loading Algorithm Data...</p>
	</div>
	
	<!-- Show main card only when not loading -->
	<div *ngIf="!isLoading" class="card shadow p-3 animate__animated animate__fadeIn">
		<div class="card-body">
	
		<!-- Handle case where steps are not yet available -->
		<div *ngIf="steps.length === 0; else stepsAvailable">
			<p class="text-muted">Algorithm steps will appear here once the data is processed.</p>
		</div>
	
		<ng-template #stepsAvailable>
			<!-- Display Current Step Information -->
			<h5 class="card-title">Step {{ currentStep + 1 }} of {{ steps.length }}</h5>
			<!-- Display the message for the current step -->
			<p class="card-text text-info fst-italic">{{ steps[currentStep].message || 'Starting...' }}</p>
	
			<hr>
	
			<div class="row mt-3">
				<!-- REMOVED Student Assignments Column -->
	
				<!-- Column for Project Status (now potentially taking full width or adjusted layout) -->
				<!-- Use col-md-12 or adjust if you have other columns -->
				<div class="col-md-12">
				<h6>Project Status (Project ID [Capacity])</h6>
				<!-- Check if projectState object exists -->
				<div *ngIf="steps[currentStep]?.projectState; else noProjectState">
					<ul class="list-group list-group-flush small">
						<!-- Iterate through projects -->
						<li class="list-group-item" *ngFor="let pid of objectKeys(steps[currentStep]?.projectState)">
						<!-- Display Project ID and its capacity -->
						<span class="fw-bold">P{{ pid }}</span> [Cap: {{ steps[currentStep].projectState[pid].capacity}}]<br>
						<!-- Display assigned students or 'None' -->
						<span class="text-muted">Assigned:</span>
						<ng-container *ngIf="steps[currentStep].projectState[pid]?.assigned && steps[currentStep].projectState[pid].assigned.length > 0; else noStudentsAssigned">
							<!-- Prefix student IDs with 'S' -->
							S{{ steps[currentStep].projectState[pid].assigned.join(', S') }}
						</ng-container>
						<ng-template #noStudentsAssigned>
							<span class="fst-italic text-secondary">None</span>
						</ng-template>
						</li>
					</ul>
				</div>
				<ng-template #noProjectState>
					<p class="text-muted small">Project status not available for this step.</p>
				</ng-template>
				</div>
			</div> <!-- End Row -->
	
			<!-- Navigation Buttons -->
			<div class="mt-4 text-center">
				<button class="btn btn-outline-primary me-2 btn-sm" (click)="prevStep()" [disabled]="currentStep === 0">
				<i class="bi bi-arrow-left"></i> Previous
				</button>
				<button class="btn btn-outline-success btn-sm" (click)="nextStep()" [disabled]="currentStep >= steps.length - 1">
				Next <i class="bi bi-arrow-right"></i>
				</button>
			</div>
		</ng-template> <!-- End stepsAvailable -->
	
		</div> <!-- End Card Body -->
	</div> <!-- End Card -->
  </div>
